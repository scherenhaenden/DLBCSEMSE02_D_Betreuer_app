@startuml ThesisManagementAPI-ClassDiagram

title Thesis Management API - Class Diagram

package "Entities" {
    class UserDataAccessModel {
        + Guid Id
        + string FirstName
        + string LastName
        + string Email
        + string PasswordHash
        + ICollection<UserRoleDataAccessModel> UserRoles
        + ICollection<UserSubjectAreaDataAccessModel> UserSubjectAreas
    }

    class RoleDataAccessModel {
        + Guid Id
        + string Name
        + ICollection<UserRoleDataAccessModel> UserRoles
    }

    class UserRoleDataAccessModel {
        + Guid UserId
        + Guid RoleId
    }

    class ThesisDataAccessModel {
        + Guid Id
        + string Title
        + Guid StatusId
        + Guid BillingStatusId
        + Guid OwnerId
        + Guid TutorId
        + Guid? SecondSupervisorId
        + Guid? SubjectAreaId
    }

    class SubjectAreaDataAccessModel {
        + Guid Id
        + string Title
        + string Description
        + bool IsActive
        + ICollection<UserSubjectAreaDataAccessModel> UserSubjectAreas
    }

    class UserSubjectAreaDataAccessModel {
        + Guid UserId
        + Guid SubjectAreaId
    }

    class BaseEntity {
        + Guid Id
        + DateTime CreatedAt
        + DateTime UpdatedAt
    }

    UserDataAccessModel --|> BaseEntity
    RoleDataAccessModel --|> BaseEntity
    ThesisDataAccessModel --|> BaseEntity
    SubjectAreaDataAccessModel --|> BaseEntity

    UserRoleDataAccessModel --> UserDataAccessModel
    UserRoleDataAccessModel --> RoleDataAccessModel
    UserSubjectAreaDataAccessModel --> UserDataAccessModel
    UserSubjectAreaDataAccessModel --> SubjectAreaDataAccessModel
    ThesisDataAccessModel --> UserDataAccessModel : "Owner"
    ThesisDataAccessModel --> UserDataAccessModel : "Tutor"
    ThesisDataAccessModel --> UserDataAccessModel : "SecondSupervisor"
    ThesisDataAccessModel --> SubjectAreaDataAccessModel
}

package "DataAccess" {
    class ThesisDbContext {
        + DbSet<UserDataAccessModel> Users
        + DbSet<RoleDataAccessModel> Roles
        + DbSet<UserRoleDataAccessModel> UserRoles
        + DbSet<ThesisDataAccessModel> Theses
        + DbSet<SubjectAreaDataAccessModel> SubjectAreas
        + DbSet<UserSubjectAreaDataAccessModel> UserSubjectAreas
    }
}

package "Services" {
    interface IUserBusinessLogicService {
        + Task<PaginatedResult<...>> GetAllAsync(...)
        + Task<UserBusinessLogicModel> GetByIdAsync(Guid id)
        + Task<UserBusinessLogicModel> GetByEmailAsync(string email)
        + Task<UserBusinessLogicModel> CreateUserAsync(...)
        + Task<bool> VerifyPasswordAsync(string email, string password)
        + Task<bool> UserHasRoleAsync(Guid userId, string roleName)
        + Task<PaginatedResponse<TutorProfileResponse>> GetTutorsAsync(Guid? SubjectAreaId, string? SubjectAreaName, int page, int pageSize)
        + Task<TutorProfileResponse> GetTutorByIdAsync(Guid id)
    }

    interface IThesisService {
        + Task<PaginatedResult<...>> GetAllAsync(int page, int pageSize, Guid userId, List<string> userRoles)
        + Task<ThesisBusinessLogicModel> GetByIdAsync(Guid id)
        + Task<ThesisBusinessLogicModel> CreateThesisAsync(...)
        + Task<ThesisBusinessLogicModel> UpdateThesisAsync(...)
        + Task<bool> DeleteThesisAsync(Guid id)
    }

    interface ISubjectAreaService {
        + Task<PaginatedResult<...>> GetAllAsync(...)
        + Task<SubjectAreaBusinessLogicModel> GetByIdAsync(Guid id)
        + Task<List<SubjectAreaBusinessLogicModel>> SearchAsync(string query, ...)
        + Task<SubjectAreaBusinessLogicModel> CreateSubjectAreaAsync(...)
        + Task<SubjectAreaBusinessLogicModel> UpdateSubjectAreaAsync(...)
        + Task<bool> DeleteSubjectAreaAsync(Guid id)
    }

    class UserBusinessLogicService
    class ThesisService
    class SubjectAreaService

    UserBusinessLogicService ..|> IUserBusinessLogicService
    ThesisService ..|> IThesisService
    SubjectAreaService ..|> ISubjectAreaService
}

package "Controllers" {
    class AuthController {
        + Task<IActionResult> Login(LoginRequest request)
    }
    class UserController {
        + Task<IActionResult> GetAll(...)
        + Task<IActionResult> Create(CreateUserRequest request)
    }
    class TutorController {
        + Task<IActionResult> GetTutors(Guid? SubjectAreaId, string? SubjectAreaName, int page, int pageSize)
        + Task<IActionResult> GetTutorById(Guid id)
    }
    class SubjectAreaController {
        + Task<IActionResult> GetAll(...)
        + Task<IActionResult> Search(...)
        + Task<IActionResult> GetById(Guid id)
        + Task<IActionResult> Create(CreateSubjectAreaRequest request)
        + Task<IActionResult> Update(Guid id, UpdateSubjectAreaRequest request)
        + Task<IActionResult> Delete(Guid id)
    }
    class ThesisController {
        + Task<IActionResult> GetAll(int page, int pageSize)
        + Task<IActionResult> GetById(Guid id)
        + Task<IActionResult> Create(CreateThesisRequest request)
        + Task<IActionResult> Update(Guid id, UpdateThesisRequest request)
        + Task<IActionResult> Delete(Guid id)
    }
}

package "Models" {
    class LoginRequest
    class LoginResponse
    class CreateUserRequest
    class UserResponse
    class PaginatedResponse<T>
    class TutorProfileResponse
    class SubjectAreaResponse
    class CreateSubjectAreaRequest
    class UpdateSubjectAreaRequest
    class CreateThesisRequest
    class UpdateThesisRequest
}

AuthController --> IUserBusinessLogicService
UserController --> IUserBusinessLogicService
TutorController --> IUserBusinessLogicService
SubjectAreaController --> ISubjectAreaService
ThesisController --> IThesisService

UserBusinessLogicService --> ThesisDbContext
ThesisService --> ThesisDbContext
SubjectAreaService --> ThesisDbContext

@enduml
